<link rel="import" href="/bower_components/app-storage/app-network-status-behavior.html">

<script>
(function() {
    'use strict';

    Polymer.PupAppBehaviorImpl = {
      properties: {
        editableNoteId: {
          type: String,
          notify: true
        }
      },

      commitChange: function(event) {
        var changeCommits;

        switch (event.detail) {
          case 'save':
            changeCommits = this.save();
            break;
          case 'delete':
            changeCommits = this.delete();
            break;
          default:
            changeCommits = Promise.resolve();
            break;
        }

        if (this.$.query && this.$.query.refresh) {
          changeCommits.then(function() {
            this.$.query.refresh();
          });
        }
      },

      save: function() {
        if (this.$.document.isNew &&
            (this.editableNote.title ||
             this.editableNote.body)) {
          return this.$.document.save(this.notesPath).then(function(){
            this.$.document.reset();
          });
        }

        return Promise.resolve();
      },

      delete: function() {
        if (!this.$.document.isNew) {
          this.$.document.destroy();
        }

        return Promise.resolve();
      },

      signOut: function() {
        console.log('signOut');
        if (this.$.auth) {
          this.$.auth.signOut();
        }
      }
  };

    Polymer.PupAppBehavior = [
        Polymer.PupAppBehaviorImpl,
        Polymer.AppNetworkStatusBehavior
    ];
})();
</script>
